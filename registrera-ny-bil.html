<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registrera ny bil</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <h1>Registrera ny bil</h1>
  <form onsubmit="event.preventDefault(); uploadCar();">
    <input type="text" id="model" placeholder="Modell" required><br>
    <input type="text" id="regNum" placeholder="Registreringsnummer" required><br>
    <input type="text" id="location" placeholder="Plats" required><br>
    <input type="date" id="available_from" required><br>
    <input type="date" id="available_to" required><br>
    <input type="time" id="start_time" required><br>
    <input type="time" id="end_time" required><br>
    <input type="file" id="image" accept="image/*"><br>
    <button type="submit">Registrera bil</button>
  </form>

  <script>
    const supabase = window.supabase.createClient(
      "https://yjybfntbsjkvnqlhpfin.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    );

    async function uploadCar() {
      const model = document.getElementById('model').value;
      const regNum = document.getElementById('regNum').value;
      const location = document.getElementById('location').value;
      const available_from = document.getElementById('available_from').value;
      const available_to = document.getElementById('available_to').value;
      const Start_time = document.getElementById('start_time').value;
      const End_time = document.getElementById('end_time').value;
      const imageInput = document.getElementById('image');

      let imageUrl = '';
      if (imageInput.files.length > 0) {
        const file = imageInput.files[0];
        const { data, error } = await supabase.storage
          .from('bilar')
          .upload(`images/${Date.now()}_${file.name}`, file, {
            cacheControl: '3600',
            upsert: false
          });

        if (error) {
          alert('Kunde inte ladda upp bilden.');
          return;
        }

        imageUrl = `https://yjybfntbsjkvnqlhpfin.supabase.co/storage/v1/object/public/bilar/${data.path}`;
      }

      const { error } = await supabase.from('Cars').insert([
        {
          Model: model,
          Reg_number: regNum,
          Location: location,
          available_from,
          available_to,
          Start_time,
          End_time,
          Image_url: imageUrl
        }
      ]);

      if (error) {
        alert('Fel vid sparning: ' + error.message);
      } else {
        alert('Bil registrerad!');
        window.location.href = "inloggad.html";
      }
    }
  </script>
</body>
</html>
