
<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hyr-dinbil</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0BCvW8uNDXkb6Q4uToK1Q8EpPpcEH0Vg&libraries=places"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <nav>
    <div><strong>Hyr-dinbil</strong></div>
    <div>
      <a href="register.html">Skapa konto</a> |
      <a href="login.html">Logga in</a>
    </div>
  </nav>

  <div class="hero">
    <h1>Hyr bil per timme nÃ¤ra dig!</h1>
    <input id="locationInput" type="text" placeholder="Stad, postnummer eller gata">
    <input id="datetimeInput" type="datetime-local">
    <button onclick="searchCars()">SÃ¶k bil</button>
  </div>

  <div id="searchResults" style="margin-top: 30px;"></div>

  <div class="features">
    <div class="feature-box">
      <h3>âœ… Snabb registrering</h3>
      <p>Kom igÃ¥ng direkt, snabbt och enkelt.</p>
    </div>
    <div class="feature-box">
      <h3>ðŸš— VÃ¤lj bil och pris</h3>
      <p>Stort urval med flexibla priser.</p>
    </div>
    <div class="feature-box">
      <h3>ðŸ’³ Betala enkelt online</h3>
      <p>Smidig betalning via dator eller mobil.</p>
    </div>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      "https://yjybfntbsjkvnqlhpfin.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    );

    const input = document.getElementById("locationInput");
    const datetimeInput = document.getElementById("datetimeInput");
    const results = document.getElementById("searchResults");

    new google.maps.places.Autocomplete(input);

    async function searchCars() {
      const plats = input.value.toLowerCase();
      const datetimeStr = datetimeInput.value;
      const datetime = datetimeStr ? new Date(datetimeStr) : null;

      const { data: cars, error } = await supabase.from("Cars").select("*");
      if (error) {
        results.innerHTML = "<p>Fel vid hÃ¤mtning av bilar.</p>";
        return;
      }

      const filtered = cars.filter(car => {
        const platsMatch = !plats || (car.Location && car.Location.toLowerCase().includes(plats));
        let dateMatch = true;
        let timeMatch = true;

        if (datetime) {
          const fromDate = car.available_from ? new Date(car.available_from) : null;
          const toDate = car.available_to ? new Date(car.available_to) : null;

          if (fromDate && toDate) {
            dateMatch = datetime >= fromDate && datetime <= toDate;
          }

          const selectedHour = datetime.getHours();
          const startHour = car.Start_time ? parseInt(car.Start_time.split(":")[0]) : null;
          const endHour = car.End_time ? parseInt(car.End_time.split(":")[0]) : null;

          if (startHour !== null && endHour !== null) {
            timeMatch = selectedHour >= startHour && selectedHour <= endHour;
          }
        }

        return platsMatch && dateMatch && timeMatch;
      });

      if (filtered.length === 0) {
        results.innerHTML = "<p>Inga bilar hittades.</p>";
        return;
      }

      results.innerHTML = filtered.map(car => `
        <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 10px; border-radius: 8px; background: #f9f9f9; display: flex; gap: 15px;">
          <img src="${car.Image_url || 'https://via.placeholder.com/120x80?text=Ingen+bild'}" style="width: 120px; height: 80px; object-fit: cover; border-radius: 4px;" />
          <div>
            <h3>${car.Model}</h3>
            <p><strong>Registreringsnummer:</strong> ${car.Reg_number}</p>
            <p><strong>Plats:</strong> ${car.Location}</p>
            <p><strong>TillgÃ¤nglig:</strong> ${car.available_from} â€“ ${car.available_to}</p>
            <p><strong>Tider:</strong> ${car.Start_time} â€“ ${car.End_time}</p>
          </div>
        </div>
      `).join("");
    }
  </script>
</body>
</html>
