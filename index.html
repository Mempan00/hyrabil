<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hyr-dinbil</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0BCvW8uNDXkb6Q4uToK1Q8EpPpcEH0Vg&libraries=places"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <nav>
    <div><strong>Hyr-dinbil</strong></div>
    <div>
      <a href="register.html">Skapa konto</a> |
      <a href="login.html">Logga in</a>
    </div>
  </nav>

  <div class="hero">
    <h1>Hyr bil per timme nÃ¤ra dig!</h1>
    <input id="locationInput" type="text" placeholder="Stad, postnummer eller gata">
    <input id="datetimeInput" type="datetime-local">
    <button onclick="searchCars()">SÃ¶k bil</button>
  </div>

  <div id="searchResults" class="car-results"></div>

  <div class="features">
    <div class="feature-box">
      <h3>âœ… Snabb registrering</h3>
      <p>Kom igÃ¥ng direkt, snabbt och enkelt.</p>
    </div>
    <div class="feature-box">
      <h3>ðŸš— VÃ¤lj bil och pris</h3>
      <p>Stort urval med flexibla priser.</p>
    </div>
    <div class="feature-box">
      <h3>ðŸ’³ Betala enkelt online</h3>
      <p>Smidig betalning via dator eller mobil.</p>
    </div>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      "https://yjybfntbsjkvnqlhpfin.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlqeWJmbnRic2prdm5xbGhwZmluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3MjA2MDUsImV4cCI6MjA2NDI5NjYwNX0.tRio5uM_QNvTbifB-ZAE-ehdX6SFNRHN0e1c5-bC_3k"
    );

    const input = document.getElementById("locationInput");
    const datetimeInput = document.getElementById("datetimeInput");
    const results = document.getElementById("searchResults");

    new google.maps.places.Autocomplete(input);

    async function searchCars() {
      const plats = input.value.toLowerCase();
      const datetimeStr = datetimeInput.value;
      const datetime = datetimeStr ? new Date(datetimeStr) : null;

      const { data: cars, error } = await supabase.from("Cars").select("*");
      if (error) {
        results.innerHTML = "<p>Fel vid hÃ¤mtning av bilar.</p>";
        return;
      }

      const filtered = cars.filter(car => {
        const platsMatch = !plats || (car.Location && car.Location.toLowerCase().includes(plats));
        let dateMatch = true;
        let timeMatch = true;

        if (datetime) {
          const fromDate = car.available_from ? new Date(car.available_from) : null;
          const toDate = car.available_to ? new Date(car.available_to) : null;

          if (fromDate && toDate) {
            dateMatch = datetime >= fromDate && datetime <= toDate;
          }

          const selectedHour = datetime.getHours();
          const startHour = car.start_time ? parseInt(car.start_time.split(":")[0]) : null;
          const endHour = car.end_time ? parseInt(car.end_time.split(":")[0]) : null;

          if (startHour !== null && endHour !== null) {
            timeMatch = selectedHour >= startHour && selectedHour <= endHour;
          }
        }

        return platsMatch && dateMatch && timeMatch;
      });

      if (filtered.length === 0) {
        results.innerHTML = "<p>Inga bilar hittades.</p>";
        return;
      }

      results.innerHTML = filtered.map(car => `
        <div class="car-card">
          <h2>${car.Model}</h2>
          <p><strong>Plats:</strong> ${car.Location}</p>
          <p><strong>Reg.nr:</strong> ${car.Reg_number}</p>
          <p><strong>TillgÃ¤nglig:</strong> ${car.available_from} â€“ ${car.available_to}</p>
          <p><strong>Tider:</strong> ${car.start_time} â€“ ${car.end_time}</p>
          <img src="${car.Image_url}" alt="${car.Model}" />
        </div>
      `).join("");
    }
  </script>
</body>
</html>
