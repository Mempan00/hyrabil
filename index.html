
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilpoolen</title>
    <link rel="stylesheet" href="style.css">
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0BCvW8uNDXkb6Q4uToK1Q8EpPpcEH0Vg&libraries=places&callback=initAutocomplete" async defer></script>
</head>
<body>
<nav>
    <div><strong>BILPOOLEN</strong></div>
    <div>
        <a href="register.html">Skapa konto</a> |
        <a href="login.html">Logga in</a>
    </div>
</nav>
<div class="hero">
    <h1>Hyr bil per timme nÃ¤ra dig!</h1>
    <input id="locationInput" type="text" placeholder="Stad, postnummer eller gata">
    <input type="datetime-local">
    <button onclick="searchCars()">SÃ¶k bil</button>
</div>
<div id="searchResults" style="margin-top: 30px;"></div>
<div class="features">
    <div class="feature-box">
        <h3>âœ… Snabb registrering</h3>
        <p>Kom igÃ¥ng direkt, snabbt och enkelt.</p>
    </div>
    <div class="feature-box">
        <h3>ðŸš— VÃ¤lj bil och pris</h3>
        <p>Stort urval med flexibla priser.</p>
    </div>
    <div class="feature-box">
        <h3>ðŸ’³ Betala enkelt online</h3>
        <p>Smidig betalning via dator eller mobil.</p>
    </div>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB0BCvW8uNDXkb6Q4uToK1Q8EpPpcEH0Vg",
    authDomain: "reg-hyrabil.firebaseapp.com",
    projectId: "reg-hyrabil",
    storageBucket: "reg-hyrabil.appspot.com",
    messagingSenderId: "467334843795",
    appId: "1:467334843795:web:4d4dab5e734363d468ec66"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<script>
  let autocomplete;

  window.initAutocomplete = function () {
    const input = document.getElementById("locationInput");

    if (input && input instanceof HTMLInputElement) {
      autocomplete = new google.maps.places.Autocomplete(input, {
        types: ["geocode"],
        componentRestrictions: { country: "se" }
      });
      console.log("Autocomplete aktiverad");
    } else {
      console.error("locationInput Ã¤r inte ett HTMLInputElement");
    }
  };

  async function searchCars() {
    const place = autocomplete?.getPlace();
    const address = document.getElementById("locationInput").value.trim().toLowerCase();
    const matchedCars = [];

    console.log("SÃ¶ker efter bilar pÃ¥ plats:", address);

    try {
      const carsSnapshot = await db.collection("cars").get();
      carsSnapshot.forEach((doc) => {
        const car = doc.data();
        const location = car.location?.toLowerCase() || "";
        if (location.includes(address)) {
          matchedCars.push({ ...car, source: "cars" });
        }
      });

      const bilarSnapshot = await db.collection("bilar").get();
      bilarSnapshot.forEach((doc) => {
        const bil = doc.data();
        const plats = bil.plats?.toLowerCase() || "";
        if (plats.includes(address)) {
          matchedCars.push({ ...bil, source: "bilar" });
        }
      });

      const resultsContainer = document.getElementById("searchResults");
      resultsContainer.innerHTML = ""; // Rensa tidigare resultat

      if (matchedCars.length > 0) {
        matchedCars.forEach(car => {
          const card = document.createElement("div");
          card.style.border = "1px solid #ccc";
          card.style.padding = "15px";
          card.style.marginBottom = "10px";
          card.style.borderRadius = "8px";
          card.style.background = "#f9f9f9";
          card.style.display = "flex";
          card.style.gap = "15px";

          const imgSrc = car.imageUrl || "https://via.placeholder.com/120x80?text=Ingen+bild";
          const image = `<img src="${imgSrc}" alt="Bilbild" style="width: 120px; height: 80px; object-fit: cover; border-radius: 4px;">`;

          const info = `
            <div>
              <h3>${car.model || car.modell || "OkÃ¤nd modell"}</h3>
              <p><strong>Registreringsnummer:</strong> ${car.registration || car.regnr || "Saknas"}</p>
              <p><strong>Plats:</strong> ${car.location || car.plats || "OkÃ¤nd"}</p>
            </div>
          `;

          card.innerHTML = image + info;
          resultsContainer.appendChild(card);
        });
      } else {
        resultsContainer.innerHTML = "<p>Inga bilar hittades pÃ¥ angiven plats.</p>";
      }
    } catch (error) {
      console.error("Fel vid hÃ¤mtning av bilar:", error);
    }
  }
</script>

</body>
</html>
