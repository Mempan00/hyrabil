<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Boka bil</title>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <h1>Boka bil</h1>
  <p>Model: <span id="model"></span></p>
  <p>Registreringsnummer: <span id="reg"></span></p>
  <button id="payButton">Betala</button>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const model = params.get("model");
      const reg = params.get("reg");

      document.getElementById("model").textContent = model || "Okänd";
      document.getElementById("reg").textContent = reg || "Okänt";

      document.getElementById("payButton").addEventListener("click", async () => {
        try {
          const response = await fetch("https://stripe-backend-1-rqtt.onrender.com/create-checkout-session", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              amount: 99900,
              success_url: window.location.origin + "/boka.html?success=true",
              cancel_url: window.location.origin + "/boka.html?canceled=true"
            })
          });

          const data = await response.json();
          if (data.url) {
            window.location.href = data.url;
          } else {
            alert("Kunde inte skapa betalningssession.");
          }
        } catch (err) {
          console.error("Fel vid betalning:", err);
          alert("Ett fel uppstod vid betalning.");
        }
      });
    });
  </script>
</body>
</html>
